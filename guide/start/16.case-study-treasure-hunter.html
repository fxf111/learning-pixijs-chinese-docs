<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pixi.js中文网</title>
    <meta name="description" content="Pixi.js中文网">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.e00e78c0.css" as="style"><link rel="preload" href="/assets/js/app.ddb19bd0.js" as="script"><link rel="preload" href="/assets/js/2.5a76e6bf.js" as="script"><link rel="preload" href="/assets/js/22.e2442f8a.js" as="script"><link rel="prefetch" href="/assets/js/10.07bb963a.js"><link rel="prefetch" href="/assets/js/11.a96a768b.js"><link rel="prefetch" href="/assets/js/12.3243e529.js"><link rel="prefetch" href="/assets/js/13.4a0d04fb.js"><link rel="prefetch" href="/assets/js/14.71b96bdc.js"><link rel="prefetch" href="/assets/js/15.b7991eaa.js"><link rel="prefetch" href="/assets/js/16.2d58517f.js"><link rel="prefetch" href="/assets/js/17.fb5bca23.js"><link rel="prefetch" href="/assets/js/18.1e9197cf.js"><link rel="prefetch" href="/assets/js/19.441237e3.js"><link rel="prefetch" href="/assets/js/20.60c38078.js"><link rel="prefetch" href="/assets/js/21.76824734.js"><link rel="prefetch" href="/assets/js/23.23acc4e5.js"><link rel="prefetch" href="/assets/js/24.883dbd29.js"><link rel="prefetch" href="/assets/js/25.d525ff3f.js"><link rel="prefetch" href="/assets/js/26.e2c92b21.js"><link rel="prefetch" href="/assets/js/27.25724ffe.js"><link rel="prefetch" href="/assets/js/28.51582c3a.js"><link rel="prefetch" href="/assets/js/29.6062ccde.js"><link rel="prefetch" href="/assets/js/3.bf15e95f.js"><link rel="prefetch" href="/assets/js/30.ecef07d2.js"><link rel="prefetch" href="/assets/js/31.07843542.js"><link rel="prefetch" href="/assets/js/32.f89fcff6.js"><link rel="prefetch" href="/assets/js/33.5abf597a.js"><link rel="prefetch" href="/assets/js/34.5cea8f23.js"><link rel="prefetch" href="/assets/js/35.4b6e88ad.js"><link rel="prefetch" href="/assets/js/36.54a09bfa.js"><link rel="prefetch" href="/assets/js/37.f11ba5e4.js"><link rel="prefetch" href="/assets/js/38.d38aab35.js"><link rel="prefetch" href="/assets/js/39.dac47686.js"><link rel="prefetch" href="/assets/js/4.0ffc361c.js"><link rel="prefetch" href="/assets/js/40.de1a89bb.js"><link rel="prefetch" href="/assets/js/41.7f29ba47.js"><link rel="prefetch" href="/assets/js/5.53c26d9c.js"><link rel="prefetch" href="/assets/js/6.ea3b84cb.js"><link rel="prefetch" href="/assets/js/7.dff0981a.js"><link rel="prefetch" href="/assets/js/8.66b28cf9.js"><link rel="prefetch" href="/assets/js/9.4d904bc0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e00e78c0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/pixijs-v5-logo-1.png" alt="Pixi.js中文网" class="logo"> <span class="site-name can-hide">Pixi.js中文网</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          学习
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/guide/start/1.introduction.html" class="nav-link">
  入门教程
</a></li><li class="dropdown-subitem"><a href="/guide/parallax-scroller/part-1.html" class="nav-link">
  进阶教程
</a></li></ul></li><li class="dropdown-item"><h4>
          其它
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://pixijs.download/release/docs/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  API
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="/pages/folder2/test4.html" class="nav-link">
  琐碎
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/pages/example/container.html" class="nav-link">
  示例
</a></div><div class="nav-item"><a href="/pages/folder1/test3.html" class="nav-link">
  功能演示
</a></div><div class="nav-item"><a href="https://github.com/fxf111/pixijs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          学习
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/guide/start/1.introduction.html" class="nav-link">
  入门教程
</a></li><li class="dropdown-subitem"><a href="/guide/parallax-scroller/part-1.html" class="nav-link">
  进阶教程
</a></li></ul></li><li class="dropdown-item"><h4>
          其它
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://pixijs.download/release/docs/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  API
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="/pages/folder2/test4.html" class="nav-link">
  琐碎
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/pages/example/container.html" class="nav-link">
  示例
</a></div><div class="nav-item"><a href="/pages/folder1/test3.html" class="nav-link">
  功能演示
</a></div><div class="nav-item"><a href="https://github.com/fxf111/pixijs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>起步</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/start/1.introduction.html" class="sidebar-link">简介</a></li><li><a href="/guide/start/2.setup.html" class="sidebar-link">安装</a></li><li><a href="/guide/start/3.stage.html" class="sidebar-link">创建应用和stage（舞台）</a></li><li><a href="/guide/start/4.sprite.html" class="sidebar-link">sprites（精灵）</a></li><li><a href="/guide/start/5.positioning-sprites.html" class="sidebar-link">定位精灵</a></li><li><a href="/guide/start/6.size-and-scale.html" class="sidebar-link">大小和缩放</a></li><li><a href="/guide/start/7.rotation.html" class="sidebar-link">旋转</a></li><li><a href="/guide/start/8.make-sprite-from-a-tileset-sub-image.html" class="sidebar-link">使用雪碧图制作精灵</a></li><li><a href="/guide/start/9.make-sprite-from-texture-atlas.html" class="sidebar-link">使用纹理贴图集制作精灵</a></li><li><a href="/guide/start/10.moving-sprites.html" class="sidebar-link">移动精灵</a></li><li><a href="/guide/start/11.game-states.html" class="sidebar-link">游戏状态</a></li><li><a href="/guide/start/12.keyboard-movement.html" class="sidebar-link">键盘移动</a></li><li><a href="/guide/start/13.grouping-sprites.html" class="sidebar-link">精灵分组</a></li><li><a href="/guide/start/14.graphic-primitive.html" class="sidebar-link">图形绘制</a></li><li><a href="/guide/start/15.collision-detection.html" class="sidebar-link">碰撞检测</a></li><li><a href="/guide/start/16.case-study-treasure-hunter.html" class="active sidebar-link">案例：寻宝猎人</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/start/16.case-study-treasure-hunter.html#代码结构" class="sidebar-link">代码结构</a></li><li class="sidebar-sub-header"><a href="/guide/start/16.case-study-treasure-hunter.html#在setup函数中初始化游戏" class="sidebar-link">在setup函数中初始化游戏</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/start/16.case-study-treasure-hunter.html#创建游戏场景" class="sidebar-link">创建游戏场景</a></li><li class="sidebar-sub-header"><a href="/guide/start/16.case-study-treasure-hunter.html#生成怪物" class="sidebar-link">生成怪物</a></li><li class="sidebar-sub-header"><a href="/guide/start/16.case-study-treasure-hunter.html#制作游戏消息文本-message-text" class="sidebar-link">制作游戏消息文本(Message Text)</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide/start/16.case-study-treasure-hunter.html#开始游戏" class="sidebar-link">开始游戏</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/start/16.case-study-treasure-hunter.html#移动猎人" class="sidebar-link">移动猎人</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide/start/16.case-study-treasure-hunter.html#移动怪物" class="sidebar-link">移动怪物</a></li><li class="sidebar-sub-header"><a href="/guide/start/16.case-study-treasure-hunter.html#碰撞检测" class="sidebar-link">碰撞检测</a></li><li class="sidebar-sub-header"><a href="/guide/start/16.case-study-treasure-hunter.html#到达出口并结束游戏" class="sidebar-link">到达出口并结束游戏</a></li></ul></li><li><a href="/guide/start/17.sprite-more.html" class="sidebar-link">精灵的额外知识</a></li><li><a href="/guide/start/18.taking-it-further.html" class="sidebar-link">进一步使用</a></li><li><a href="/guide/start/19.support.html" class="sidebar-link">支持这个项目</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>进阶</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>我已经告诉过你，你现在已经拥有了开始制作游戏所需的所有技能。什么?你不相信我?让我来证明给你看!让我们来看看如何做一个简单的物品收集和躲避敌人的游戏--<strong>寻宝猎人</strong>。(你可以在<code>examples</code>文件夹中找到它。)</p> <p><img src="/26.png" alt=""></p> <p>使用键盘上的箭头键可帮助探险家找到宝藏并将其带到出口。 六个怪物在地牢壁之间上下移动，如果探险家触碰到怪物，他将变成半透明，并且右上角的生命值会减少。 如果所有的生命值都用光了，会显示“You Lost!”； 如果探险家带着宝藏到达出口，会显示“You Won!”。 尽管它是一个基本的原型，但《寻宝猎人》包含了大型游戏中的大多数元素：纹理图集图形，交互，碰撞以及多个游戏场景。</p> <h2 id="代码结构"><a href="#代码结构" class="header-anchor">#</a> 代码结构</h2> <p>打开<code>treasureHunter.html</code>文件，你会发现所有的游戏代码都在一个大文件中。代码结构如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//Setup Pixi and load the texture atlas files - call the `setup`</span>
<span class="token comment">//function when they've loaded</span>

<span class="token keyword">function</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">//Initialize the game sprites, set the game `state` to `play`</span>
 <span class="token comment">//and start the 'gameLoop'</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">gameLoop</span><span class="token punctuation">(</span><span class="token parameter">delta</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">//Runs the current game `state` in a loop and renders the sprites</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token parameter">delta</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">//All the game logic goes here</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">//All the code that should run at the end of the game</span>
<span class="token punctuation">}</span>

<span class="token comment">//The game's helper functions:</span>
<span class="token comment">//`keyboard`, `hitTestRectangle`, `contain` and `randomInt`</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="在setup函数中初始化游戏"><a href="#在setup函数中初始化游戏" class="header-anchor">#</a> 在setup函数中初始化游戏</h2> <p>加载纹理图集图像后，<code>setup</code>即会运行。 它仅运行一次，并允许您为游戏执行一次设置任务。 在这里创建和初始化对象，精灵，游戏场景，填充数据数组或解析加载的JSON游戏数据。</p> <p>这是Treasure Hunter中<code>setup</code>方法的概要：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//Create the `gameScene` group</span>
  <span class="token comment">//Create the `door` sprite</span>
  <span class="token comment">//Create the `player` sprite</span>
  <span class="token comment">//Create the `treasure` sprite</span>
  <span class="token comment">//Make the enemies</span>
  <span class="token comment">//Create the health bar</span>
  <span class="token comment">//Add some text for the game over message</span>
  <span class="token comment">//Create a `gameOverScene` group</span>
  <span class="token comment">//Assign the player's keyboard controllers</span>

  <span class="token comment">//set the game state to `play`</span>
  state <span class="token operator">=</span> play<span class="token punctuation">;</span>

  <span class="token comment">//Start the game loop </span>
  app<span class="token punctuation">.</span>ticker<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">delta</span> <span class="token operator">=&gt;</span> <span class="token function">gameLoop</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>最后两行代码，<code>state = play;gameLoop()</code>很重要。将<code>gameLoop</code>添加到Pixi的ticker，并在一个连续的循环中调用<code>play</code>函数。</p> <p>先让我们看看<code>setup</code>函数里做了哪些事情。</p> <h3 id="创建游戏场景"><a href="#创建游戏场景" class="header-anchor">#</a> 创建游戏场景</h3> <p><code>setup</code>函数创建了两个名为<code>gameScene</code>和<code>gameOverScene</code>的容器分组，它们都被添加到舞台上。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>gameScene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>gameScene<span class="token punctuation">)</span><span class="token punctuation">;</span>

gameOverScene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>gameOverScene<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>所有属于主游戏的精灵都被添加到<code>gameScene</code>分组。游戏结束时显示的文本将被添加到<code>gameOverScene</code>分组中。</p> <p><img src="/27.png" alt=""></p> <p>尽管<code>gameOverScene</code>在<code>setup</code>中被创建，但是在游戏开始时，不应该被显示出来。所以，我们给它的<code>visible</code>属性设置为<code>false</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>gameOverScene<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当游戏结束时，<code>gameOverScene</code>的<code>visible</code>属性将被设置为<code>true</code>，以显示在游戏结束时出现的文本。这件事我们稍后再处理。</p> <h3 id="生成怪物"><a href="#生成怪物" class="header-anchor">#</a> 生成怪物</h3> <p>我们通过循环语句创建了六个怪物。 每个怪物都被赋予一个随机的初始位置和速度。 每个怪物的垂直速度交替乘以1或-1，这就是每个怪物上下来回移动的原因。 我们把怪物都会放进一个叫<code>blobs</code>的数组中。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> numberOfBlobs <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>
    spacing <span class="token operator">=</span> <span class="token number">48</span><span class="token punctuation">,</span>
    xOffset <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">,</span>
    speed <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
    direction <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">//An array to store all the blob monsters</span>
blobs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//Make as many blobs as there are `numberOfBlobs`</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numberOfBlobs<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">//Make a blob</span>
  <span class="token keyword">let</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sprite</span><span class="token punctuation">(</span>id<span class="token punctuation">[</span><span class="token string">&quot;blob.png&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//Space each blob horizontally according to the `spacing` value.</span>
  <span class="token comment">//`xOffset` determines the point from the left of the screen</span>
  <span class="token comment">//at which the first blob should be added</span>
  <span class="token keyword">let</span> x <span class="token operator">=</span> spacing <span class="token operator">*</span> i <span class="token operator">+</span> xOffset<span class="token punctuation">;</span>

  <span class="token comment">//Give the blob a random `y` position</span>
  <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> stage<span class="token punctuation">.</span>height <span class="token operator">-</span> blob<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//Set the blob's position</span>
  blob<span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
  blob<span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>

  <span class="token comment">//Set the blob's vertical velocity. `direction` will be either `1` or</span>
  <span class="token comment">//`-1`. `1` means the enemy will move down and `-1` means the blob will</span>
  <span class="token comment">//move up. Multiplying `direction` by `speed` determines the blob's</span>
  <span class="token comment">//vertical direction</span>
  blob<span class="token punctuation">.</span>vy <span class="token operator">=</span> speed <span class="token operator">*</span> direction<span class="token punctuation">;</span>

  <span class="token comment">//Reverse the direction for the next blob</span>
  direction <span class="token operator">*=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token comment">//Push the blob into the `blobs` array</span>
  blobs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//Add the blob to the `gameScene`</span>
  gameScene<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>##3 制作生命条</p> <p>当你玩这个游戏的时候，猎人接触到一个敌人的时候，屏幕右上角的生命条的宽度会减小。这个生命条是怎么做的?它只是两个位置完全相同的重叠矩形:一个黑色矩形在后面，一个红色矩形在前面。我们把它俩放到<code>healthBar</code>分组里。然后将<code>healthBar</code>添加到<code>gameScene</code>并放置在舞台上。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//Create the health bar</span>
healthBar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
healthBar<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>stage<span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
gameScene<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>healthBar<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Create the black background rectangle</span>
<span class="token keyword">let</span> innerBar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>Graphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
innerBar<span class="token punctuation">.</span><span class="token function">beginFill</span><span class="token punctuation">(</span><span class="token number">0x000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
innerBar<span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
innerBar<span class="token punctuation">.</span><span class="token function">endFill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
healthBar<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>innerBar<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Create the front red rectangle</span>
<span class="token keyword">let</span> outerBar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>Graphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
outerBar<span class="token punctuation">.</span><span class="token function">beginFill</span><span class="token punctuation">(</span><span class="token number">0xFF3300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
outerBar<span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
outerBar<span class="token punctuation">.</span><span class="token function">endFill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
healthBar<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>outerBar<span class="token punctuation">)</span><span class="token punctuation">;</span>

healthBar<span class="token punctuation">.</span>outer <span class="token operator">=</span> outerBar<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>您可以看到一个名为<code>outer</code>的属性已添加到<code>healthBar</code>。 它仅引用<code>outerBar</code>（红色矩形），以便以后方便使用。比如，修改它的<code>width</code>，这样做简洁易读。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>healthBar<span class="token punctuation">.</span>outer <span class="token operator">=</span> outerBar<span class="token punctuation">;</span>
healthBar<span class="token punctuation">.</span>outer<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="制作游戏消息文本-message-text"><a href="#制作游戏消息文本-message-text" class="header-anchor">#</a> 制作游戏消息文本(Message Text)</h3> <p>当游戏结束时，会显示“You won!” 或 “You lost!”这样的文字!这是使用一个文本精灵，并将其添加到<code>gameOverScene</code>。因为<code>gameOverScene</code>的<code>visible</code>属性在游戏开始时被设置为<code>false</code>，所以你还不能看到这个文本。下面是<code>setup</code>函数里的相关代码，该函数创建消息文本并将其添加到<code>gameOverScene</code>中。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> style <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextStyle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    fontFamily<span class="token operator">:</span> <span class="token string">&quot;Futura&quot;</span><span class="token punctuation">,</span>
    fontSize<span class="token operator">:</span> <span class="token number">64</span><span class="token punctuation">,</span>
    fill<span class="token operator">:</span> <span class="token string">&quot;white&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string">&quot;The End!&quot;</span><span class="token punctuation">,</span> style<span class="token punctuation">)</span><span class="token punctuation">;</span>
message<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">;</span>
message<span class="token punctuation">.</span>y <span class="token operator">=</span> app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">32</span><span class="token punctuation">;</span>
gameOverScene<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="开始游戏"><a href="#开始游戏" class="header-anchor">#</a> 开始游戏</h2> <p>所有的游戏逻辑和精灵移动代码，都放在了<code>play</code>函数中。我们看下，<code>play</code>函数包含哪些东西：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token parameter">delta</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//Move the explorer and contain it inside the dungeon</span>
  <span class="token comment">//Move the blob monsters</span>
  <span class="token comment">//Check for a collision between the blobs and the explorer</span>
  <span class="token comment">//Check for a collision between the explorer and the treasure</span>
  <span class="token comment">//Check for a collision between the treasure and the door</span>
  <span class="token comment">//Decide whether the game has been won or lost</span>
  <span class="token comment">//Change the game `state` to `end` when the game is finished</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>让我们看看所有这些功能是如何运行的。</p> <h3 id="移动猎人"><a href="#移动猎人" class="header-anchor">#</a> 移动猎人</h3> <p>猎人是用键盘控制的，而实现这一功能的代码与前面学习的键盘控制代码非常相似。<code>keyboard</code>对象修改猎人的速度，<code>play</code>函数根据速度更新猎人的位置。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>explorer<span class="token punctuation">.</span>x <span class="token operator">+=</span> explorer<span class="token punctuation">.</span>vx<span class="token punctuation">;</span>
explorer<span class="token punctuation">.</span>y <span class="token operator">+=</span> explorer<span class="token punctuation">.</span>vy<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="移动范围"><a href="#移动范围" class="header-anchor">#</a> 移动范围</h4> <p>猎人只能在墙壁内移动，下图的绿色边框展示了猎人的移动范围。</p> <p><img src="/28.png" alt=""></p> <p>我们已经在自定义函数<code>contain</code>中处理了这件事。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">contain</span><span class="token punctuation">(</span>explorer<span class="token punctuation">,</span> <span class="token punctuation">{</span>x<span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> width<span class="token operator">:</span> <span class="token number">488</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token number">480</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>contain</code>有两个参数。第一个是你想限制移动范围的精灵。第二个是由<code>x</code>, <code>y</code>, <code>width</code>, <code>height</code>属性的一个对象，代表的是一个矩形区域，精灵只能在这个区域内移动。在本例中，这个对象定义了一个区域，该区域与舞台的偏移量很小。它与地牢墙壁的尺寸相匹配。</p> <p>这是完成所有这些工作的<code>contain</code>函数。该函数检查精灵是否越过了边界。如果有，则代码将精灵移回该边界。<code>contain</code>函数还返回一个<code>collision</code>变量，该变量的值为“top”、“right”、“bottom”或“left”，这取决于精灵击中边界的哪一侧。(如果精灵没有触碰任何边界，<code>collision</code>的值是<code>undefined</code>。)</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">contain</span><span class="token punctuation">(</span><span class="token parameter">sprite<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> collision <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>

  <span class="token comment">//Left</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sprite<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> container<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sprite<span class="token punctuation">.</span>x <span class="token operator">=</span> container<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    collision <span class="token operator">=</span> <span class="token string">&quot;left&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//Top</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sprite<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> container<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sprite<span class="token punctuation">.</span>y <span class="token operator">=</span> container<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    collision <span class="token operator">=</span> <span class="token string">&quot;top&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//Right</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sprite<span class="token punctuation">.</span>x <span class="token operator">+</span> sprite<span class="token punctuation">.</span>width <span class="token operator">&gt;</span> container<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sprite<span class="token punctuation">.</span>x <span class="token operator">=</span> container<span class="token punctuation">.</span>width <span class="token operator">-</span> sprite<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    collision <span class="token operator">=</span> <span class="token string">&quot;right&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//Bottom</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sprite<span class="token punctuation">.</span>y <span class="token operator">+</span> sprite<span class="token punctuation">.</span>height <span class="token operator">&gt;</span> container<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sprite<span class="token punctuation">.</span>y <span class="token operator">=</span> container<span class="token punctuation">.</span>height <span class="token operator">-</span> sprite<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    collision <span class="token operator">=</span> <span class="token string">&quot;bottom&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//Return the `collision` value</span>
  <span class="token keyword">return</span> collision<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h2 id="移动怪物"><a href="#移动怪物" class="header-anchor">#</a> 移动怪物</h2> <p><code>play</code>函数里，也对怪物做了碰撞检测，使它们在地牢范围内移动。如果碰到了墙壁，那它就会回头，向相反相反方向移动。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>blobs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">blob</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">//Move the blob</span>
  blob<span class="token punctuation">.</span>y <span class="token operator">+=</span> blob<span class="token punctuation">.</span>vy<span class="token punctuation">;</span>

  <span class="token comment">//Check the blob's screen boundaries</span>
  <span class="token keyword">let</span> blobHitsWall <span class="token operator">=</span> <span class="token function">contain</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> <span class="token punctuation">{</span>x<span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> width<span class="token operator">:</span> <span class="token number">488</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token number">480</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//If the blob hits the top or bottom of the stage, reverse</span>
  <span class="token comment">//its direction</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>blobHitsWall <span class="token operator">===</span> <span class="token string">&quot;top&quot;</span> <span class="token operator">||</span> blobHitsWall <span class="token operator">===</span> <span class="token string">&quot;bottom&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    blob<span class="token punctuation">.</span>vy <span class="token operator">*=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//Test for a collision. If any of the enemies are touching</span>
  <span class="token comment">//the explorer, set `explorerHit` to `true`</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">hitTestRectangle</span><span class="token punctuation">(</span>explorer<span class="token punctuation">,</span> blob<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    explorerHit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>在上面的代码中，您可以看到我们是如何使用<code>contain</code>函数的返回值，使怪物在墙壁间往返移动的。<code>blobHitsWall</code>这个变量用于捕获它返回值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> blobHitsWall <span class="token operator">=</span> <span class="token function">contain</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> <span class="token punctuation">{</span>x<span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> width<span class="token operator">:</span> <span class="token number">488</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token number">480</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>将怪物的<code>vy</code>(垂直速度)值乘以-1，就能让他向相反方向移动了。</p> <h2 id="碰撞检测"><a href="#碰撞检测" class="header-anchor">#</a> 碰撞检测</h2> <p>我们用<code>hitTestRectangle</code>这个方法来检测猎人是否触碰到怪物。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">hitTestRectangle</span><span class="token punctuation">(</span>explorer<span class="token punctuation">,</span> blob<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  explorerHit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果<code>hitTestRectangle</code>返回<code>true</code>，这意味猎人和怪物发生了碰撞，<code>explorerHit</code>的变量的值被设为<code>true</code>。如果<code>explorerHit</code>为<code>true</code>，则<code>play</code>函数使猎人半透明，并将生命条的宽度减少1像素。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span>explorerHit<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">//Make the explorer semi-transparent</span>
  explorer<span class="token punctuation">.</span>alpha <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>

  <span class="token comment">//Reduce the width of the health bar's inner rectangle by 1 pixel</span>
  healthBar<span class="token punctuation">.</span>outer<span class="token punctuation">.</span>width <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

  <span class="token comment">//Make the explorer fully opaque (non-transparent) if it hasn't been hit</span>
  explorer<span class="token punctuation">.</span>alpha <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>如果<code>explorerHit</code>的值为<code>false</code>，那么我们把猎人的<code>alpha</code>属性设为1，让他不透明。</p> <p><code>play</code>函数中还会检查宝藏和猎人之间的碰撞。如果命中，宝藏<code>treasure</code>的位置将被设置为距猎人有稍微偏移的位置。这使它看起来像是猎人在带着宝藏移动。</p> <p><img src="/29.png" alt=""></p> <p>让我们看下相关的代码。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hitTestRectangle</span><span class="token punctuation">(</span>explorer<span class="token punctuation">,</span> treasure<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  treasure<span class="token punctuation">.</span>x <span class="token operator">=</span> explorer<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span>
  treasure<span class="token punctuation">.</span>y <span class="token operator">=</span> explorer<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="到达出口并结束游戏"><a href="#到达出口并结束游戏" class="header-anchor">#</a> 到达出口并结束游戏</h2> <p>有两种情况结束游戏：一个是，你带着宝藏到达出口；另一个就是，你的生命条为0。</p> <p>如果你带着宝藏，到达出口，那就赢得了游戏，游戏状态<code>state</code>的值被设为<code>end</code>，然后<code>message</code>的文字被设为<code>You won</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hitTestRectangle</span><span class="token punctuation">(</span>treasure<span class="token punctuation">,</span> door<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> end<span class="token punctuation">;</span>
  message<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">&quot;You won!&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如果你的生命条为0，那你输掉了游戏。<code>state</code>被设为<code>end</code>，<code>message</code>的文字被设为<code>You lost</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>healthBar<span class="token punctuation">.</span>outer<span class="token punctuation">.</span>width <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> end<span class="token punctuation">;</span>
  message<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">&quot;You lost!&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这是啥意思呢？</p> <p>如果你还记得前面的例子，<code>gameLoop</code>每秒执行60次，<code>gameLoop</code>执行，都会调用<code>state</code>方法更新游戏状态。如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">gameLoop</span><span class="token punctuation">(</span><span class="token parameter">delta</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token comment">//Update the current game state:</span>
  <span class="token function">state</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>你也一定记得，我们初始化的时候，给<code>state</code>赋的值是<code>play</code>。现在游戏结束了，我们不需要再执行<code>play</code>了，要替换为<code>end</code>。在一个较大的游戏中，可能会有<code>tileScene</code>这个状态，代表的是游戏等级，例如<code>levelOne</code>、<code>levelTwo</code>、<code>levelThree</code>等。</p> <p>现在让我们看下<code>end</code>函数都做了哪些事情：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gameScene<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  gameOverScene<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>它只是翻转了游戏场景的可见性。游戏结束时，让<code>gameScene</code>隐藏，让<code>gameOverScene</code>显示。</p> <p>这是一个非常简单的示例，说明了如何切换游戏状态，但是您可以在游戏中拥有任意数量的游戏状态，并根据需要填充尽可能多的代码。 只需将<code>state</code>的值更改为要在循环中运行的任何函数。</p> <p>而这正是宝藏猎人的全部！ 只需多做一些工作，您就可以将这个简单的原型变成完整的游戏-试试吧！</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">lastUpdate:</span> <span class="time">3/21/2020, 2:47:02 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guide/start/15.collision-detection.html" class="prev">
        碰撞检测
      </a></span> <span class="next"><a href="/guide/start/17.sprite-more.html">
        精灵的额外知识
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ddb19bd0.js" defer></script><script src="/assets/js/2.5a76e6bf.js" defer></script><script src="/assets/js/22.e2442f8a.js" defer></script>
  </body>
</html>
